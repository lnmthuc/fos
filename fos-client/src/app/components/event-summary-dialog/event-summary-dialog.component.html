<app-loading [loading]="loading"></app-loading>
<div id="container" *ngIf="!printService.isPrinting" class="container">
  <div id="email-region" class="email-region">
    <app-event-summary-print
      *ngIf="isEmailDataAvailable()"
      [eventData]="eventData"
    >
    </app-event-summary-print>
  </div>
  <div id="report" class="event-summary">
    <mat-card>
      <h1 style="text-align:center">
        <span
          style="
          color: #e57d13;
        "
          >
          Event
        </span>
        Summary
      </h1>
      <mat-card-content>
        <mat-grid-list class="grid-card" cols="2" rowHeight="fit">
          <mat-grid-tile>
            <mat-card class="card">
              <!-- <mat-card-header>
                <mat-card-title>Event</mat-card-title>
              </mat-card-header> -->
              <mat-card-content>
                <mat-grid-list cols="2" rowHeight="50px">
                  <div class="grid-tile-row">
                    <mat-grid-tile
                      ><div class="label-inside-grid">Event</div></mat-grid-tile
                    >
                    <mat-grid-tile></mat-grid-tile>
                  </div>
                  <div class="grid-tile-row">
                    <mat-grid-tile
                      ><div class="text-inside-grid">Name</div></mat-grid-tile
                    >
                    <mat-grid-tile
                      ><div class="text-inside-grid" *ngIf="eventDataAvailable">
                        {{ eventDetail.Name }}
                      </div></mat-grid-tile
                    >
                  </div>
                  <mat-grid-tile
                    ><div class="text-inside-grid">Host</div></mat-grid-tile
                  >
                  <mat-grid-tile
                    ><div class="text-inside-grid" *ngIf="eventDataAvailable">
                      {{ eventDetail.HostName }}
                    </div></mat-grid-tile
                  >
                  <mat-grid-tile
                    ><div class="text-inside-grid">
                      Time to close
                    </div></mat-grid-tile
                  >
                  <mat-grid-tile
                    ><div class="text-inside-grid" *ngIf="eventDataAvailable">
                      {{ toStandardDate(eventDetail.CloseTime) }}
                    </div></mat-grid-tile
                  >
                  <mat-grid-tile
                    ><div class="text-inside-grid">Status</div></mat-grid-tile
                  >
                  <mat-grid-tile
                    ><div class="text-inside-grid">
                      <div
                        *ngIf="
                          eventDetail.Status === 'Opened' ||
                          eventDetail.Status === 'Reopened'
                        "
                        class="opened status"
                      >
                        <span class="dot"></span>
                        <p>Open</p>
                      </div>
                      <div
                        *ngIf="eventDetail.Status === 'Closed'"
                        class="closedStatus status"
                      >
                        <span class="dot"></span>
                        <p>Closed</p>
                      </div>
                      <div
                        *ngIf="eventDetail.Status === 'Error'"
                        class="canceled status"
                      >
                        <span class="dot"></span>
                        <p>Canceled</p>
                      </div>
                    </div></mat-grid-tile
                  >
                </mat-grid-list>
              </mat-card-content>
            </mat-card>
          </mat-grid-tile>
          <mat-grid-tile>
            <mat-card class="card">
              <!-- <mat-card-header>
                <mat-card-title>Restaurant</mat-card-title>
                <mat-card-subtitle></mat-card-subtitle>
              </mat-card-header> -->
              <mat-card-content>
                <mat-grid-list cols="2" rowHeight="50px" guttterSize="10px">
                  <div class="grid-tile-row">
                    <mat-grid-tile
                      ><div class="label-inside-grid">
                        Restaurant
                      </div></mat-grid-tile
                    >
                    <mat-grid-tile></mat-grid-tile>
                  </div>
                  <mat-grid-tile
                    ><div class="text-inside-grid">Name</div></mat-grid-tile
                  >
                  <mat-grid-tile
                    ><div *ngIf="eventDataAvailable" class="text-inside-grid">
                      {{ eventDetail.Restaurant }}
                    </div></mat-grid-tile
                  >
                  <mat-grid-tile
                    ><div class="text-inside-grid">Address</div></mat-grid-tile
                  >
                  <mat-grid-tile
                    ><div *ngIf="restaurant.isLoaded" class="text-inside-grid">
                      {{ restaurant.address }}
                    </div></mat-grid-tile
                  >
                  <mat-grid-tile
                    ><div class="text-inside-grid">
                      Restaurant Url
                    </div></mat-grid-tile
                  >
                  <mat-grid-tile
                    ><div *ngIf="restaurant.isLoaded" class="text-inside-grid">
                      <a
                        target="_blank"
                        href="https://www.now.vn/ho-chi-minh/{{
                          restaurant.UrlRewriteName
                        }}"
                        >Restaurant Url</a
                      >
                    </div></mat-grid-tile
                  >
                  <mat-grid-tile
                    ><div class="text-inside-grid">Rating</div></mat-grid-tile
                  >
                  <mat-grid-tile *ngIf="restaurant.isLoaded">
                    <div class="text-inside-grid">
                      <ngx-stars
                        [readonly]="true"
                        [maxStars]="5"
                        [initialStars]="restaurant.Rating"
                      ></ngx-stars>
                    </div>
                  </mat-grid-tile>
                </mat-grid-list>
              </mat-card-content>
            </mat-card>
          </mat-grid-tile>
        </mat-grid-list>

        <mat-tab-group dynamicHeight #tabGroup>
          <mat-tab label="Dishes Group View">
            <table mat-table [dataSource]="dishGroupViewdataSource">
              <ng-container matColumnDef="select" *ngIf="reOrder">
                <th mat-header-cell *matHeaderCellDef>
                  <mat-checkbox
                    (change)="$event ? masterToggle() : null"
                    [checked]="selection.hasValue() && isAllSelected()"
                    [indeterminate]="selection.hasValue() && !isAllSelected()"
                    [aria-label]="checkboxLabel()"
                  >
                  </mat-checkbox>
                </th>
                <td mat-cell *matCellDef="let row">
                  <mat-checkbox
                    (click)="$event.stopPropagation()"
                    (change)="$event ? selection.toggle(row) : null"
                    [checked]="selection.isSelected(row)"
                    [aria-label]="checkboxLabel(row)"
                  >
                  </mat-checkbox>
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="picture">
                <th mat-header-cell *matHeaderCellDef>Picture</th>
                <td mat-cell *matCellDef="let element">
                  <div style="width: 68px; height: 68px;">
                    <app-photo
                      *ngIf="element.Picture"
                      [src]="element.Picture"
                    ></app-photo>
                  </div>
                </td>
                <td mat-footer-cell *matFooterCellDef>Total</td>
              </ng-container>
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let element">{{ element.Name }}</td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef>Amount</th>
                <td mat-cell *matCellDef="let element">{{ element.Amount }}</td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="price">
                <th mat-header-cell *matHeaderCellDef>Price</th>
                <td mat-cell *matCellDef="let element">
                  <app-adjust-price
                    [baseCost]="getOriginalPrice(element)"
                    [adjustedCost]="element.Price"
                  ></app-adjust-price>
                  <!-- {{ element.Price ? element.Price + "Ä‘" : "" }}
                  {{ getDiscountedPrice(element) }} -->
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="total">
                <th mat-header-cell *matHeaderCellDef>Total</th>
                <td mat-cell *matCellDef="let element">
                  <app-adjust-price
                    [baseCost]="element.Total"
                    [adjustedCost]="element.Total"
                  ></app-adjust-price>
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  <app-adjust-price
                    [baseCost]="baseTotalCost"
                    [adjustedCost]="adjustedTotalCost"
                  ></app-adjust-price>
                </td>
              </ng-container>
              <ng-container matColumnDef="totalComment">
                <th mat-header-cell *matHeaderCellDef>Comment</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngFor="let comment of element.Comments">
                    {{ comment.Amount }}x {{ comment.Value }},
                  </span>
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="numberOfUser">
                <th mat-header-cell *matHeaderCellDef>Number of users</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.NumberOfUser }}x<button
                  class="show-users-button"
                  (click)="showUsers(element.UserIds, element.Name)"
                  mat-icon-button
                  matTooltip="Show users ordered this food"
                >
                  <mat-icon aria-hidden="false" aria-label="People icon"
                    >people</mat-icon
                  >
                </button>
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>

              <tr
                mat-header-row
                *matHeaderRowDef="dishGroupViewDisplayedColumns"
              ></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: dishGroupViewDisplayedColumns"
              ></tr>
              <tr
                mat-footer-row
                *matFooterRowDef="dishGroupViewDisplayedColumns"
              ></tr>
            </table>

            <img src="" />
          </mat-tab>
          <mat-tab label="Person Group View">
            <table
              *ngIf="personViewDataAvailable"
              mat-table
              [dataSource]="personGroupViewdataSource"
            >
              <ng-container matColumnDef="user">
                <th mat-header-cell *matHeaderCellDef>User</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.User.DisplayName }}
                </td>
              </ng-container>
              <ng-container matColumnDef="food">
                <th mat-header-cell *matHeaderCellDef>Food</th>
                <td mat-cell *matCellDef="let element">{{ element.Food }}</td>
              </ng-container>
              <ng-container matColumnDef="price">
                <th mat-header-cell *matHeaderCellDef>Price</th>
                <td mat-cell *matCellDef="let element">
                  <app-adjust-price
                    [baseCost]="element.Price"
                    [adjustedCost]="element.Cost"
                  ></app-adjust-price>
                </td>
              </ng-container>
              <ng-container matColumnDef="pay-extra">
                <th mat-header-cell *matHeaderCellDef>Pay extra</th>
                <td mat-cell *matCellDef="let element">
                  <app-adjust-price
                    [baseCost]="element.PayExtra"
                    [adjustedCost]="element.PayExtra"
                  ></app-adjust-price>
                </td>
              </ng-container>
              <ng-container matColumnDef="comment">
                <th mat-header-cell *matHeaderCellDef>Comment</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngFor="let comment of element.Comments">
                    {{ comment.Amount }}x {{ comment.Value }},
                  </span>
                </td>
              </ng-container>
              <ng-container matColumnDef="editMakeOrder" *ngIf="isHostUser">
                <th mat-header-cell *matHeaderCellDef>Edit Order</th>
                <td mat-cell *matCellDef="let element">
                  <app-edit-make-order
                    matTooltip="Edit Order By Host"
                    [isHostUser]="isHostUser"
                    [eventDetail]="eventDetail"
                    [user]="element.User"
                  ></app-edit-make-order>
                </td>
              </ng-container>
              <tr
                mat-header-row
                *matHeaderRowDef="personGroupViewDisplayedColumns"
              ></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: personGroupViewDisplayedColumns"
              ></tr>
            </table>
          </mat-tab>
        </mat-tab-group>
        <app-promotions-chip-list
          *ngIf="promotionDataAvailable"
          [deliveryId]="eventDetail.DeliveryId"
          [eventId]="eventDetail.EventId"
          [promotions]="promotions"
          [eventPromotion]="eventPromotion"
          [changable]="promoteChangeAble"
          [isHost]="isHostUser"
          (promotionChanged)="adjustPrice($event)"
        ></app-promotions-chip-list>
      </mat-card-content>
      <mat-card-actions align="end">
        <button
          (click)="reportDisheout()"
          mat-flat-button
          color="warn"
          *ngIf="!reOrder && isHostUser"
        >
          Report dishes out of order
        </button>
        <button
          (click)="reOpenEvent()"
          mat-flat-button
          color="warn"
          *ngIf="!reOrder && isHostUser && eventDetail.Status === 'Closed'"
        >
          Reopen
        </button>
        <button
          (click)="closeEvent()"
          mat-flat-button
          color="warn"
          *ngIf="
            !reOrder &&
            isHostUser &&
            (eventDetail.Status === 'Opened' ||
              eventDetail.Status === 'Reopened')
          "
        >
          Close event
        </button>
        <button
          (click)="sendEmail()"
          mat-flat-button
          color="primary"
          *ngIf="!reOrder"
        >
          Send to my email
        </button>
        <button
          (click)="printToPdf()"
          mat-flat-button
          color="primary"
          *ngIf="!reOrder"
        >
          Print
        </button>
        <button (click)="exportExcel()" mat-flat-button color="primary">
          Export To Excel
        </button>
        <button
          (click)="sendEmailFeedback()"
          mat-flat-button
          color="warn"
          *ngIf="isHostUser && eventDetail.Status === 'Closed'"
        >
          Send email feedbacks
        </button>
        <button
          (click)="
            eventDetail.Status === 'Closed' ? openDialog() : resendOrder()
          "
          mat-flat-button
          color="primary"
          *ngIf="reOrder"
        >
          Resend Order
        </button>
        <button (click)="onNoClick()" mat-stroked-button *ngIf="reOrder">
          Cancel
        </button>
        <!-- <button mat-flat-button color="warn">Close</button> -->
      </mat-card-actions>
      <app-loading [loading]="feedbackLoading"></app-loading>
    </mat-card>
  </div>
</div>
