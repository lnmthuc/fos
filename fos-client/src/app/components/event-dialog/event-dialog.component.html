<!-- <p>event-dialog works!</p> -->
<!-- <h2>{{data.restaurant.Name}}</h2> -->
<!-- <h2>{{data.deliveryid}}</h2>
<h2>{{data.id}}</h2> -->

<section fxLayout="row wrap" fxLayoutAlign="center center">
  <mat-card fxFlex="500px" fxFlex.xs="100%">
    <mat-card-title>Create a new event</mat-card-title>

    <form
      [formGroup]="ownerForm"
      autocomplete="off"
      novalidate
      (ngSubmit)="CreateOwner(ownerForm.value)"
    >
      <div class="tp-container">
        <mat-form-field>
          <input
            matInput
            type="text"
            placeholder="Event Title"
            formControlName="title"
            id="title"
          />
          <mat-hint align="end">Event title is required.</mat-hint>
          <mat-error *ngIf="HasError('title', 'required')"
            >Event title is required.</mat-error
          >
        </mat-form-field>

        <mat-label class="fog">Event Type</mat-label>
        <mat-radio-group
          aria-labelledby="Event Type"
          class="radio-group"
          formControlName="EventType"
        >
          <mat-radio-button class="radio-button" value="Open">
            Free For All
          </mat-radio-button>
          <mat-radio-button class="radio-button" value="Close">
            Invited Only
          </mat-radio-button>
        </mat-radio-group>
        <div class="event-type-hint">
          {{
            getCurrentEventType() == "Open"
              ? "Open for everyone"
              : "Only for invited person"
          }}<br />
        </div>

        <app-event-dialog-userpicker
          class="full-width"
          (ListenChildComponentEvent)="notifyMessage($event)"
          [formGroup]="ownerForm"
          formControlName="userInputHost"
          pickupTitle="Host"
        ></app-event-dialog-userpicker>

        <mat-form-field class="full-width">
          <input
            matInput
            placeholder="Restaurant"
            [matAutocomplete]="autoTest"
            formControlName="userInput"
          />
        </mat-form-field>
        <mat-autocomplete #autoTest="matAutocomplete" [displayWith]="displayFn">
          <mat-option *ngIf="isLoading" class="is-loading"
            ><mat-spinner diameter="30"></mat-spinner
          ></mat-option>
          <ng-container *ngIf="!isLoading">
            <mat-option
              *ngFor="let restaurant of restaurant"
              [value]="restaurant"
            >
              <app-menu [restaurant]="restaurant"></app-menu>
              <span>{{ restaurant.Name }}</span>
            </mat-option>
          </ng-container>
        </mat-autocomplete>

        <mat-form-field class="full-width">
          <mat-label>Maximum Budget</mat-label>
          <input
            matInput
            type="number"
            placeholder="Maximum Budget"
            formControlName="MaximumBudget"
          />
        </mat-form-field>
        <mat-label class="fog">Restaurant's Promotions</mat-label>

        <mat-form-field class="full-width">
          <div class="promotion">
            <mat-chip-list #chipList aria-label="Fruit selection">
              <app-promotions-chip
                *ngFor="let promotion of promotions"
                [visible]="visible"
                [selectable]="selectable"
                [removable]="removable"
                [addOnBlur]="addOnBlur"
                [promotion]="promotion"
                (removePressed)="removePromotion($event)"
              ></app-promotions-chip>
            </mat-chip-list>
            <button mat-flat-button color="primary" (click)="fetchAllPromotions()">
              Get all promotions
            </button>
          </div>
        </mat-form-field>

        <div class="event-data-time full-width">
          <app-datetimepicker
            class="datetimepicker"
            (onDateTimeChange)="onDateTimeInputChange($event)"
            [formGroup]="ownerForm"
            [formLable]="'Event'"
            dateFormControlName="eventDate"
            timeFormControlName="eventTime"
          ></app-datetimepicker>
          <app-datetimepicker
            class="datetimepicker"
            (onDateTimeChange)="onDateTimeInputChange($event)"
            [formGroup]="ownerForm"
            [formLable]="'Close'"
            dateFormControlName="closeDate"
            timeFormControlName="closeTime"
          ></app-datetimepicker>
          <app-datetimepicker
            class="datetimepicker"
            (onDateTimeChange)="onDateTimeInputChange($event)"
            [formGroup]="ownerForm"
            [formLable]="'Remind'"
            dateFormControlName="remindDate"
            timeFormControlName="remindTime"
          ></app-datetimepicker>
        </div>
        <mat-grid-list cols="10" rowHeight="100px">
          <mat-grid-tile [colspan]="4">
            <app-event-dialog-userpicker
              class="full-width"
              (ListenChildComponentEvent)="notifyMessage($event)"
              [formGroup]="ownerForm"
              formControlName="userInputPicker"
              pickupTitle="Choose Participants"
              [participantList] ="eventUsers"
            ></app-event-dialog-userpicker>
          </mat-grid-tile>
          <mat-grid-tile>
            <button mat-flat-button color="primary" (click)="AddUserToTable()">
              Add
            </button>
          </mat-grid-tile>
          <mat-grid-tile [colspan]="4" class="custom-group">
            <mat-form-field class="full-width">
              <mat-label>Custom group</mat-label>
              <mat-select (selectionChange)="selectGroup($event)">
                <mat-option *ngFor="let group of groups" [value]="group.ID">
                  {{ group.Name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </mat-grid-tile>
          <mat-grid-tile>
            <button mat-flat-button color="primary" (click)="addGroupToTable()">
              Add
            </button>
          </mat-grid-tile>
        </mat-grid-list>
        <table mat-table [dataSource]="eventUsers">
          <ng-container matColumnDef="avatar">
            <th mat-header-cell *matHeaderCellDef>Avatar</th>
            <td mat-cell *matCellDef="let element">
              <div class="avatar-padding">
                <img
                  id="avatar"
                  class="make-circle-avatar"
                  src="{{ apiUrl }}api/SPUser/GetAvatar?Id={{
                    element.Id
                  }}&avatarName={{ element.Name }}"
                />
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>User/Group</th>
            <td mat-cell *matCellDef="let element">{{ element.Name }}</td>
          </ng-container>

          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Email</th>
            <td mat-cell *matCellDef="let element">{{ element.Email }}</td>
          </ng-container>

          <ng-container matColumnDef="order status">
            <th mat-header-cell *matHeaderCellDef>Order Status</th>
            <td mat-cell *matCellDef="let element">Not Ordered</td>
          </ng-container>

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>Delete</th>
            <td mat-cell *matCellDef="let element">
              <button mat-icon-button (click)="DeleteUserInTable(element.Name)">
                <i class="material-icons">delete</i>
              </button>
            </td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns; sticky: true"
          ></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>

        <mat-card-actions align="right">
          <button
            mat-flat-button
            color="primary"
            [disabled]="!ownerForm.valid"
            (click)="SaveToSharePointEventList()"
          >
            Create
          </button>
          <button type="button" mat-stroked-button (click)="OnNoClick()">
            Cancel
          </button>
        </mat-card-actions>
      </div>
    </form>
  </mat-card>
</section>

<app-loading [loading]="loading"></app-loading>
